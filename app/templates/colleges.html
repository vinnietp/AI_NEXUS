{% extends "base.html" %}
{% block title %}Colleges{% endblock %}

{% block content %}
  <section class="page-section">
    <!-- Page bar / CTA row -->
    <div class="page-bar">
      <h1 class="page-title">Manage Colleges</h1>
      <button type="button"
              class="btn btn-secondary js-open-modal"
              data-modal="#collegeModal">
        Add College
      </button>
    </div>

    <!-- Small stats -->
    <div class="small-stats-container">
      <div class="small-stat-card">
        <h3>Active Colleges</h3>
        <div class="value">{{ active_count or 0 }}</div>
        <div class="icon">üè´</div>
      </div>
      <div class="small-stat-card">
        <h3>Inactive Colleges</h3>
        <div class="value">{{ inactive_count or 0 }}</div>
        <div class="icon">‚è∏Ô∏è</div>
      </div>
    </div>

    <!-- Toolbar: search (left) + RHS filters (right) -->
    <div class="clubs-toolbar" style="margin-top:16px;">
      <form class="search-bar" method="get" action="{{ url_for('colleges') }}">
        <span class="search-icon">üîç</span>
        <input
          type="text"
          id="collegeSearch"
          name="q"
          value="{{ q or '' }}"
          placeholder="Search Colleges"
        />
        <div id="collegeChoices" hidden></div>
      </form>

      <!-- IMPORTANT: same class as clubs so CSS matches -->
      <div class="clubs-toolbar-right">
        <label class="filter-select-wrap" aria-label="Filter by status">
          <select class="filter-select" id="collegeStatusFilter" name="status">
            <option value="all"      {{ 'selected' if (status or 'all') == 'all' }}>All status</option>
            <option value="active"   {{ 'selected' if (status or '') == 'active' }}>Active</option>
            <option value="inactive" {{ 'selected' if (status or '') == 'inactive' }}>Inactive</option>
          </select>
        </label>

        <label class="filter-select-wrap" aria-label="Sort by">
          <select class="filter-select" id="collegeSortBy" name="sort">
            <option value="none"    {{ 'selected' if (sort or 'none') == 'none' }}>Sort by</option>
            <option value="name"    {{ 'selected' if (sort or '') == 'name' }}>College Name</option>
            <option value="members" {{ 'selected' if (sort or '') == 'members' }}>Members</option>
            <option value="newest"  {{ 'selected' if (sort or '') == 'newest' }}>Newest</option>
            <option value="oldest"  {{ 'selected' if (sort or '') == 'oldest' }}>Oldest</option>
          </select>
        </label>
      </div>
    </div>

  <!-- Featured Card (filled by JS) -->
  <div class="featured-chapter-card" id="featuredCollegeCard" hidden>
    <button class="card-close-btn" id="fcCloseBtn" title="Close">√ó</button>
    <div class="featured-chapter-image">
      <img id="fcImage" alt="" />
    </div>

    <div class="featured-chapter-content">
      <h3 class="featured-chapter-title" id="fcName"></h3>
      <p class="featured-chapter-description" id="fcLocation"></p>

      <div class="featured-chapter-stats">
        <div class="featured-chapter-stat">
          <span class="icon">üìß</span>
          <span id="fcEmail">‚Äî</span>
        </div>
        <div class="featured-chapter-stat">
          <span class="icon">üìä</span>
          <span id="fcStatus">‚Äî</span>
        </div>
      </div>

      <div class="featured-chapter-actions">
        <a href="#" class="action-btn" id="fcEditBtn">Edit</a>
        <a href="#" class="delete-btn" id="fcDeleteBtn">Delete</a>
      </div>
    </div>
  </div>
  <!-- Featured Card end -->

    <!-- All Colleges Table -->
    <div class="table-container">
      <div class="table-header">All Colleges</div>
      <table class="table" data-table="colleges">
        <thead>
          <tr>
            <th>College Name</th>
            <th>Members</th>
            <th>Clubs</th>
            <th>Mail Id</th>
            <th>Location</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
        {% if colleges and colleges|length > 0 %}
          {% for c in colleges %}
            {% set _status = (c.status or 'active')|lower %}
            <tr
                     data-id="{{ c.college_id }}"              {# <-- add this #}
              data-name="{{ c.college_name }}"
              data-status="{{ _status }}"
              data-members="{{ c.members_count or 0 }}"
              data-location="{{ c.location or '' }}"
              data-email="{{ c.email or '' }}"
              data-created="{{ (c.created_time.isoformat() if c.created_time else '%010d'|format(c.college_id)) }}"
            >
              <td data-col="name">{{ c.college_name }}</td>
              <td data-col="members">{{ c.members_count or 0 }}</td>
              <td>{{ c.clubs_count or 0 }}</td>
              <td>{{ c.email or "‚Äî" }}</td>
              <td>{{ c.location or "‚Äî" }}</td>
              <td data-col="status">
                {% if _status == 'active' %}
                  <span class="status status-active">Active</span>
                {% else %}
                  <span class="status status-inactive">Inactive</span>
                {% endif %}
              </td>
              <td>
                <a
                  href="#collegeEditModal"
                  class="action-btn js-open-modal js-edit-college"
                  data-modal="#collegeEditModal"
                  data-id="{{ c.college_id }}"
                  data-name="{{ c.college_name }}"
                  data-email="{{ c.email or '' }}"
                  data-location="{{ c.location or '' }}"
                  data-authority-name="{{ c.authority_name or '' }}"
                  data-authority-role="{{ c.authority_role or '' }}"
                  data-phone="{{ c.phone or '' }}"
                  data-description="{{ c.description or '' }}"
                  data-status="{{ _status }}"
                >Edit</a>
                <a href="#" class="delete-btn js-delete-college" data-id="{{ c.college_id }}" data-name="{{ c.college_name }}">Delete</a>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7" style="text-align:center;opacity:.7;">No colleges found.</td>
          </tr>
        {% endif %}
        </tbody>
      </table>
            <nav id="collegesPagination" class="pagination" aria-label="Colleges pagination"></nav>

    </div>
  </section>

  {% include "components/college_modal.html" %}
  {% include "components/college_edit_modal.html" %}

{# Hidden delete forms (template-route fallback) #}
<form id="deleteClubForm" method="POST" action="{{ url_for('delete_club_form') }}" style="display:none;">
  <input type="hidden" name="club_id" id="deleteClubId">
</form>
<form id="deleteEventForm" method="POST" action="{{ url_for('delete_event_form') }}" style="display:none;">
  <input type="hidden" name="event_id" id="deleteEventId">
</form>
<form id="deleteCollegeForm" method="POST" action="{{ url_for('delete_college_form') }}" style="display:none;">
  <input type="hidden" name="college_id" id="deleteCollegeId">
</form>
<form id="deleteCoordinatorForm" method="POST" action="{{ url_for('delete_coordinator_form') }}" style="display:none;">
  <input type="hidden" name="coordinator_id" id="deleteCoordinatorId">
</form>
<form id="deleteAnnouncementForm" method="POST" action="{{ url_for('delete_announcement_form') }}" style="display:none;">
  <input type="hidden" name="announcement_id" id="deleteAnnouncementId">
</form>

{# Delete confirmation modal (Flipkart style) #}
<div id="deleteConfirmModal" class="delete-modal-overlay" hidden>
  <div class="delete-modal">
    <div class="delete-modal-header">
      <h3>Delete College</h3>
      <button type="button" class="delete-close" id="closeDeleteModal">√ó</button>
    </div>
    <div class="delete-modal-body">
      <p>Are you sure you want to delete this college?</p>
    </div>
    <div class="delete-modal-footer">
      <button id="confirmDeleteBtn" class="btn btn-danger">DELETE</button>
      <button id="cancelDeleteBtn" class="btn btn-secondary">CANCEL</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}
