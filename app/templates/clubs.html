{% extends "base.html" %}

{% block title %}clubs{% endblock %}

{% block content %}
<section class="page-section">
  <!-- Page bar / CTA row -->
  <div class="page-bar">
    <h1 class="page-title">Manage clubs</h1>

    <button type="button"
      class="btn btn-secondary js-open-modal"
      data-modal="#clubModal">
      Create New club
    </button>
  </div>

    <!-- Toolbar: search (left) + RHS filters (right) -->
    <div class="clubs-toolbar">
      <!-- Search -->
      <form class="search-bar" method="get" action="{{ url_for('clubs') }}">
        <span class="search-icon">üîç</span>
        <input type="text" id="clubSearch" name="q" value="{{ q or '' }}" placeholder="Search Clubs" />
        <div id="clubChoices" hidden></div>
      </form>

    <!-- Right side filters -->
    <div class="clubs-toolbar-right">
      <label class="filter-select-wrap" aria-label="Filter by status">
        <select class="filter-select" id="statusFilter" name="status">
          <option value="all">All status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </label>

      <label class="filter-select-wrap" aria-label="Sort by">
        <select class="filter-select" id="sortBy" name="sort">
          <option value="none">Sort by</option>
          <option value="name">Club Name</option>
          <option value="coordinator">Coordinator Name</option>
          <option value="newest">Newest</option>
          <option value="oldest">Oldest</option>
        </select>
      </label>
    </div>
  </div>

  <!-- Featured Card (filled by JS) -->
  <div class="featured-chapter-card" id="featuredCard" hidden>
    <div class="featured-chapter-image">
      <img id="feImageUrl" alt="" />
    </div>

    <div class="featured-chapter-content">
      <h3 class="featured-chapter-title" id="feName"></h3>
      <p class="featured-chapter-description" id="feDescription"></p>

      <div class="featured-chapter-stats">
        <div class="featured-chapter-stat">
          <span class="icon">üë•</span>
          <span id="feMembers">0</span> Members
        </div>
        <div class="featured-chapter-stat">
          <span class="icon">üéì</span>
          <span id="feCoordinator">‚Äî</span>
        </div>
      </div>

      <div class="featured-chapter-actions">
        <a href="#" class="action-btn" id="feEditBtn">Edit</a>
        <a href="#" class="delete-btn" id="feDeleteBtn">Delete</a>
        <button class="card-close-btn" id="feCloseBtn" title="Close">√ó</button>
      </div>
    </div>
  </div>
  <!-- Featured Card end -->

  <!-- All clubs Table -->
  <div class="table-container">
    <div class="table-header">All clubs</div>
    <table class="table" data-table="clubs">
      <thead>
        <tr>
          <th>club</th>
          <th>Coordinator</th>
          <th>Members</th>
          <th>Colleges</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
      {% if clubs and clubs|length > 0 %}
        {% for ch in clubs %}
          {% set status_txt = (ch.status or 'active')|lower %}
          <tr
            data-id="{{ ch.club_id }}"
            data-name="{{ ch.club_name }}"
            data-coordinator="{{ ch.coordinator or '' }}"
            data-status="{{ status_txt }}"
            data-members="{{ ch.members or 0 }}"
            data-created="{{ ch.created_time.isoformat() if ch.created_time }}"
          >
            <!-- Club Name -->
            <td data-col="name">{{ ch.club_name }}</td>

            <!-- Coordinator -->
            <td data-col="coordinator">{{ ch.coordinator or "‚Äî" }}</td>

            <!-- Members (placeholder until implemented) -->
            <td data-col="members">{{ ch.members or 0 }}</td>

            <!-- Colleges (placeholder until implemented) -->
            <td>‚Äî</td>

            <!-- Status -->
            <td data-col="status">
              <span class="status {{ 'status-active' if status_txt == 'active' else 'status-inactive' }}">
                {{ status_txt|capitalize }}
              </span>
            </td>

            <!-- Actions -->
            <td>
              <a
                href="#clubEditModal"
                class="action-btn js-open-modal js-edit-club"
                data-modal="#clubEditModal"
                data-id="{{ ch.club_id }}"
                data-name="{{ ch.club_name }}"
                data-coordinator="{{ ch.coordinator or '' }}"
                data-category="{{ ch.club_category or '' }}"
                data-type="{{ ch.coordinator_type or '' }}"
                data-description="{{ ch.description or '' }}"
                data-image-url="{{ url_for('static', filename=ch.club_logo) if ch.club_logo else '' }}"
                data-image-name="{{ ch.club_logo.split('/')[-1] if ch.club_logo else '' }}"
                data-status="{{ status_txt }}"
              >
                Edit
              </a>
              <a href="#" class="delete-btn js-delete-club" data-id="{{ ch.club_id }}" data-name="{{ ch.club_name }}">Delete</a>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" style="text-align:center; opacity:.7;">No clubs found.</td>
        </tr>
      {% endif %}
      </tbody>
    </table>
        <nav id="clubsPagination" class="pagination" aria-label="Clubs pagination"></nav>

  </div>
</section>

{# Hidden delete forms (template-route fallback) #}
<form id="deleteClubForm" method="POST" action="{{ url_for('delete_club_form') }}" style="display:none;">
  <input type="hidden" name="club_id" id="deleteClubId">
</form>
<form id="deleteEventForm" method="POST" action="{{ url_for('delete_event_form') }}" style="display:none;">
  <input type="hidden" name="event_id" id="deleteEventId">
</form>
<form id="deleteCollegeForm" method="POST" action="{{ url_for('delete_college_form') }}" style="display:none;">
  <input type="hidden" name="college_id" id="deleteCollegeId">
</form>
<form id="deleteCoordinatorForm" method="POST" action="{{ url_for('delete_coordinator_form') }}" style="display:none;">
  <input type="hidden" name="coordinator_id" id="deleteCoordinatorId">
</form>
<form id="deleteAnnouncementForm" method="POST" action="{{ url_for('delete_announcement_form') }}" style="display:none;">
  <input type="hidden" name="announcement_id" id="deleteAnnouncementId">
</form>

{# Delete confirmation modal (Flipkart style) #}
<div id="deleteConfirmModal" class="delete-modal-overlay" hidden>
  <div class="delete-modal">
    <div class="delete-modal-header">
      <h3>Delete Club</h3>
      <button type="button" class="delete-close" id="closeDeleteModal">√ó</button>
    </div>
    <div class="delete-modal-body">
      <p>Are you sure you want to Delete this club?</p>
    </div>
    <div class="delete-modal-footer">
      <button id="confirmDeleteBtn" class="btn btn-danger">DELETE</button>
      <button id="cancelDeleteBtn" class="btn btn-secondary">CANCEL</button>
    </div>
  </div>
</div>

{# Modals #}
{% include "components/club_modal.html" %}
{% include "components/club_edit_modal.html" %}
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}
